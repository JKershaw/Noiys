var MongoClient = require('./lib/mongodb').MongoClient
	, ObjectID = require('./lib/mongodb').ObjectID;

// MongoClient.connect('mongodb://localhost:27017/test', {db: {native_parser:false}}, function(err, db) {
// 	console.log("============================== 0")
// 	// db.collection('t').insert({"ffdddddd": {"ffd\0x00ddddd":2}}, function(err, db) {
// 	db.collection('t').insert([{sort:1}, {sort:2}, {sort:3}], function(err, r) {
// 	console.log("============================== 1")
// 	console.dir(err)
// 	console.dir(err)

// 		// db.collection('t').find({}).toArray(function(err, docs) {
// 		db.collection('t').find({}, {sort: [['sort', 'ascending']]}).toArray(function(err, docs) {
// 	console.log("============================== 2")
// 			console.dir(err)
// 			console.dir(docs)
// 			db.close();
// 			process.exit(0)
// 		})
// 	});
// })
console.log("=============================== CONNECT 0")
MongoClient.connect('mongodb://localhost:27017/test', {db: {native_parser:false}}, function(err, db) {
// MongoClient.connect('mongodb://localhost:31000/test', {db: {native_parser:false}}, function(err, db) {
	console.log("=============================== CONNECT 1")
		var r1 = {
				ok: 1
			, n: 1
			, upsert: new ObjectID()
		}

		var r2 = {
				ok: 1
			, n: 1
			, upsert: [{index:0, _id: new ObjectID()}]
		}

		console.log("size r1: " + db.bson.calculateObjectSize(r1))
		console.log("size r2: " + db.bson.calculateObjectSize(r2))
		// console.dir(db.bson.calculate)
	// db.collection('t').remove(function() {
		// db.collection('t').save({_id:0}, function(err, r) {
		// 	db.collection('t').save({_id:0}, function(err, r) {
		// 		console.dir(err)
		// 		console.dir(r)
		db.collection('test').count(function(err, count) {
		console.log("=============================== CONNECT 2")
		console.dir(count)

				db.close();			
		})
	// 		})
	// 	})
	// });
})