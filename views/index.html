<!DOCTYPE html>
<html>
	<head>
		<title>
			NOIYS - Post, read, forget
		</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<!-- JavaScript plugins (requires jQuery) -->
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js">
								        
		</script>
		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css">
		<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js">
												            
			</script>
			<script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js">
												            
			</script>
		<![endif]-->
		<!-- Include all compiled plugins (below), or include individual files as needed
		-->
		<script src="//netdna.bootstrapcdn.com/bootstrap/3.0.2/js/bootstrap.min.js">
								        
		</script>
	</head>
	<body>
		<div class="container">
			<h1>
				NOIYS
			</h1>
			<p>
				Post a status anonymously. It's viewed by many, then deleted. Try not to be a dick.
			</p>
			<p>
				<textarea class="form-control" rows="3" id="statusText"></textarea>
			</p>
			<p>
				<small>
					Your status will be automatically deleted after 24 hours
				</small>
			</p>
			<p>
				<button type="button" class="btn btn-primary btn-lg" id="post_status">
					Post Status
				</button>
				<button type="button" class="btn btn-default btn-xs" id="pause_feed">
					Pause Feed
				</button>
			</p>
			<div id="statuses">
			</div>
		</div>
		<script type="text/javascript">

						var paused = false;
						
						function get_and_show_random_status() {
							if (paused === false){
								$.get("status", function(data) {

									// delete existing posts with this ID
									$("#statuses #" + data.id).remove();

									// show new one
									$("#statuses").prepend("<div class=\"panel panel-default status_panel\" id=\"" + data.id + "\"><div class=\"panel-body\">" + data.text + " <br /><small><span style=\"font-weight:bold;\" class=\"votes\">" + data.votes + "</span>  <a style=\"cursor:pointer; color: green;\" onclick=\"vote('" + data.id + "')\" >VERB GOES HERE</a></small></div></div>");

									$("#statuses div").first().hide().fadeIn();
								});
							}

							setTimeout(get_and_show_random_status, Math.floor((Math.random()*10000)+1));
						}

						$(document).ready(function() {
							setTimeout(get_and_show_random_status, 1000);
						});

						$("#post_status").click(function() {
							$('#post_status').prop('disabled', true);
							$('#post_status').text("Posting ...");


							$.ajax({
								url: '/status',
								type: 'POST',
								contentType: 'application/json',
								data: JSON.stringify({
									text: $('#statusText').val()
								})
							}).done(function(data) {
								$('#post_status').prop('disabled', false);
								$('#post_status').text("Posted!");
								$('#statusText').val("");

								setTimeout(set_posted_button, 2000);
							});
						});

						$("#pause_feed").click(function() {
							if (paused === true){
								paused = false;
								$('#pause_feed').text("Pause Feed");
							} else {
								paused = true;
								$('#pause_feed').text("Un-pause Feed");
							}
						});

						function vote(id)
						{
							$("#" + id + " .votes").text(parseInt($("#" + id + " .votes").text())+1);

							$.ajax({
								url: '/vote',
								type: 'POST',
								contentType: 'application/json',
								data: JSON.stringify({
									id: id
								})
							}).done(function(data) {
								//something?
							});
						}

						function set_posted_button()
						{
							$('#post_status').text("Post Status");
						}
		</script>
	</body>

</html>